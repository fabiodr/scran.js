<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SCRANJS - Analyze single-cell datasets in the browser</title>
    <style>
        .file-input {
            padding-top: 0.35rem;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1/dist/tailwind.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/daisyui@1.11.0/dist/full.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="navbar mb-2 shadow-lg bg-neutral text-neutral-content">
        <div class="flex-none hidden lg:flex">
            <button class="btn btn-square btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    class="inline-block w-6 h-6 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
            </button>
        </div>
        <div class="flex-1 hidden px-2 mx-2 lg:flex">
            <span class="text-lg font-bold">
                SCRAN JS - Analyze Single Cell Datasets
            </span>
        </div>
        <div class="flex-none hidden px-2 mx-2 lg:flex">
            <div class="flex items-stretch">
                <!-- <a class="btn btn-ghost btn-sm rounded-btn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 mr-2 stroke-current">              
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>            
                </svg>
                      Likes
                    
              </a>  -->
                <a class="btn btn-ghost btn-sm rounded-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        class="inline-block w-5 mr-2 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                        </path>
                    </svg>
                    Notifications

                </a>
                <!-- <a class="btn btn-ghost btn-sm rounded-btn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 mr-2 stroke-current">          
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>                
                </svg>
                      Files
                    
              </a>  -->
                <a href="#logs" class="modal-button btn btn-ghost btn-sm rounded-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        class="inline-block w-5 mr-2 stroke-current">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                    LOGS
                </a>
                <!-- <label for="modal-notif" class="btn btn-ghost modal-button">open modal</label> 
              <input type="checkbox" id="modal-notif" class="modal-toggle"> 
              <div class="modal">
                <div class="modal-box">
                  <p>Enim dolorem dolorum omnis atque necessitatibus. Consequatur aut adipisci qui iusto illo eaque. Consequatur repudiandae et. Nulla ea quasi eligendi. Saepe velit autem minima.</p> 
                  <div class="modal-action">
                    <label for="modal-notif" class="btn btn-primary">Accept</label> 
                    <label for="modal-notif" class="btn">Close</label>
                  </div>
                </div>
              </div> -->
            </div>
        </div>
        <!-- <div class="flex-1 lg:flex-none">
          <div class="form-control">
            <input type="text" placeholder="Search" class="input input-ghost">
          </div>
        </div> 
        <div class="flex-none">
          <button class="btn btn-square btn-ghost">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current">             
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>             
            </svg>
          </button>
        </div>  -->
        <!-- <div class="flex-none">
            <button class="btn btn-square btn-ghost">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    class="inline-block w-6 h-6 stroke-current">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                    </path>
                </svg>
            </button>
        </div> -->
        <!-- <div class="flex-none">
          <div class="avatar">
            <div class="rounded-full w-10 h-10 m-1">
              <img src="https://i.pravatar.cc/500?img=32">
            </div>
          </div>
        </div> -->
    </div>

    <div class="flex-col">
        <div class="flex  justify-center space-x-4">
            <div class="shadow stats">
                <div id="odata" class="stat">
                    <div class="stat-title">Matrix Dims</div>
                    <div class="stat-value">?????</div>
                    <div class="stat-desc">...</div>
                </div>
            </div>
            <div class="shadow stats">
                <div id="fdata" class="stat">
                    <div class="stat-title">Filtered Matrix Dims</div>
                    <div class="stat-value">?????</div>
                    <div class="stat-desc">...</div>
                </div>
            </div>
        </div>
    </div>

    <ul class="w-full steps">
        <li id="load-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#loadData" class="link">Load Data</a>
            </button>
        </li>
        <li id="qc-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#performQC" class="link">Perform QC</a>
            </button>
        </li>
        <li id="fsel-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#featureSelection" class="link">Feature Selection</a>
            </button>
        </li>
        <li id="pca-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#performPCA" class="link">PCA</a>
            </button>
        </li>
        <li id="clyster-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#performCluster" class="link">Cluster</a>
            </button>
        </li>
        <li id="mg-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#performMGA" class="link">Marker Genes</a>
            </button>
        </li>
        <!-- <li id="de-data-btn" data-content="?" class="step step-neutral">
            <button class="btn btn-ghost">
                <a href="#performDE" class="link">Diff. Expression</a>
            </button>
        </li> -->
        <li data-content="●" class="step step-neutral">Done</li>
    </ul>

    <div class="flex-col space-y-6">
        <div id="loadData" class="flex justify-center">
            <div class="card w-5/6 lg:card-side bordered shadow">
                <div class="card-body">
                    <h2 class="card-title">Load Data</h2>
                    <p>Upload either a mtx file (w/ barcodes and/or genes) or generate [random] test data to use the app
                    </p>
                    <div class="flex justify-evenly">
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Upload MTX File</span>
                            </label>
                            <div class="relative">
                                <input id="mtx-upload-file" type="file" placeholder="Search"
                                    class="file-input w-full pr-16 input input-primary input-bordered">
                            </div>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Upload Barcodes File</span>
                            </label>
                            <div class="relative">
                                <input id="barcodes-upload-file" type="file" placeholder="Search"
                                    class="file-input w-full pr-16 input input-primary input-bordered">
                            </div>
                        </div>
                        <div class="form-control">
                            <label class="label">
                                <span class="label-text">Upload Genes File</span>
                            </label>
                            <div class="relative">
                                <input id="genes-upload-file" type="file" placeholder="Search"
                                    class="file-input w-full pr-16 input input-primary input-bordered">
                            </div>
                        </div>
                    </div>

                    <div class="card-actions">
                        <button id="mtx-upload-submit" class="btn btn-primary">Upload data</button>
                        <button id="mtx-generate-submit" class="btn btn-ghost">Generate Test Data</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="performQC" class="flex justify-center">
            <div class="card w-5/6 lg:card-side bordered shadow">
                <div class="card-body">
                    <h2 class="card-title">Perform QC</h2>
                    <p>Generate per cell QC metrics and filter cells</p>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">NMADS: Number of MADs from the median, to use for defining outliers. (defaults to 3)</span>
                        </label>
                        <div class="relative">
                            <input id="qc-nmads-input" type="number" placeholder="3"
                                class="w-full pr-16 input input-primary input-bordered">
                        </div>
                    </div>
                    <div id="qc_charts" class="flex flex-wrap justify-evenly"></div>

                    <div class="card-actions">
                        <button id="qc-submit" class="btn btn-primary">Run QC</button>
                        <button id="qc-filter-submit" class="btn btn-ghost">Confirm QC Filters</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="featureSelection" class="flex justify-center">
            <div class="card w-5/6 lg:card-side bordered shadow">
                <div class="card-body">
                    <h2 class="card-title">Feature Selection</h2>
                    <p>Model the variance of the log-expression values for each gene, accounting for the mean-variance
                        trend.
                    </p>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Span factor: The span of the LOWESS smoother for fitting the mean-variance trend. (defaults to 0.3)</span>
                        </label>
                        <div class="relative">
                            <input id="fsel-input" type="number" placeholder="0.3"
                                class="w-full pr-16 input input-primary input-bordered">
                        </div>
                    </div>
                    <div id="fsel_charts" class="flex flex-wrap justify-evenly">
                        <div class="clusterize">
                            <div id="scrollArea" class="clusterize-scroll">
                                <table>
                                    <thead>
                                        <tr id="row_header">
                                            <th>Genes</th>
                                            <th>Means</th>
                                            <th>Vars</th>
                                            <th>Fitted</th>
                                            <th>Residuals</th>
                                        </tr>
                                    </thead>
                                    <tbody id="contentArea" class="clusterize-content">
                                        <tr class="clusterize-no-data">
                                            <td>Loading data…</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card-actions">
                        <button id="fsel-submit" class="btn btn-primary">Compute Gene Metrics</button>
                        <!-- <button id="mtx-generate-submit" class="btn btn-ghost">Generate Test Data</button> -->
                    </div>
                </div>
            </div>
        </div>

        <div id="performPCA" class="flex justify-center">
            <div class="card w-5/6 lg:card-side bordered shadow">
                <div class="card-body">
                    <h2 class="card-title">Perform PCA</h2>
                    <p>Perform a principal components analysis to obtain per-cell coordinates in low-dimensional space.</p>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Choose # of PCs (defaults to 5)</span>
                        </label>
                        <div class="relative">
                            <input id="pcs-input" type="number" placeholder="5"
                                class="w-full pr-16 input input-primary input-bordered">
                        </div>
                    </div>
                    <div id="pca_charts" class="flex flex-wrap justify-evenly"></div>
                    <div class="card-actions">
                        <button id="pca-submit" class="btn btn-primary">Compute PCs</button>
                        <!-- <button id="mtx-generate-submit" class="btn btn-ghost">Generate Test Data</button> -->
                    </div>
                </div>
            </div>
        </div>

        <div id="performCluster" class="flex justify-center">
            <div class="card w-5/6 lg:card-side bordered shadow">
                <div class="card-body">
                    <h2 class="card-title">Perform Clustering</h2>
                    <p>Generate SNN graph and cluster</p>
                    <div id="cluster_charts" class="flex flex-wrap justify-evenly"></div>

                    <div class="card-actions">
                        <button id="cluster-submit" class="btn btn-primary">Cluster cells</button>
                        <!-- <button id="mtx-generate-submit" class="btn btn-ghost">Generate Test Data</button> -->
                    </div>
                </div>
            </div>
        </div>

        <div class="flex-col">
            <div class="flex justify-center">
                <div id="logs" class="mockup-code w-5/6">
                </div>
            </div>
        </div>
    </div>


    <!-- <script src="scran_wasm.js"></script> -->
    <script src="../scranjs/boxPlot.js"></script>
    <script type="module" src="./index.js"></script>

    <!-- TODO: should be part of the repo later on -->
    <!-- UIkit CSS -->
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.7.1/dist/css/uikit.min.css" /> -->

    <!-- UIkit JS -->
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.7.1/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.7.1/dist/js/uikit-icons.min.js"></script>

    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-2.3.0.min.js"></script>

    <!-- GRID JS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script> -->

    <!-- clusterize -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clusterize.js/0.18.0/clusterize.js"
        integrity="sha512-NPPrAOcaIEBqkr4XyF/OuiDsZK/+BTj8I6fnIBNVsb/D7RQmueUh7v8GX0DNZ0iodTuIu5ts00bMz8iLFdxH5g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- D3JS v6 -->
    <script src="https://d3js.org/d3.v6.js"></script>
</body>

</html>